@using Entities
@using Business

<div class="container mb-3">
    <div class="row justify-content-md-center">
        <div class="col-sm">
            <label class="form-label">Dni:</label>
            <input type="text" class="form-control" placeholder="Ingrese DNI" @bind-value="Dni"/>
        </div>
        <div class="col-sm">
            <label class="form-label">Nombre:</label>
            <input type="text" class="form-control" placeholder="Ingrese Nombre" @bind-value="Nombre" />
        </div>
    </div>
    <div class="row justify-content-md-center mb-3">
        <div class="col-sm">
             <label class="form-label">Fecha de ingreso:</label>
            <InputDate @bind-Value="FechaIngreso" class="form-control" />
        </div>
        <div class="col-sm">
            <label class="form-label">Fecha de nacimiento:</label>
            <InputDate @bind-Value="FechaNacimiento" class="form-control" />
        </div>
    </div>
    <button @onclick="ChangedFilters" class="btn btn-primary">Buscar</button>
</div>



<div class="scroll-table table-responsive" style="height:33rem; overflow: scroll;">
            <table class="table table-hover table-bordered">
                <thead>
                    <tr>
                        <th>Referencia</th>
                        <th>Nombres y Apellidos</th>
                        <th>DNI</th>
                        <th>Celular</th>
                        <th>Equipo</th>
                        <th>Correo</th>
                        <th>Fecha ingreso a Indra</th>
                        <th>Fecha de nacimiento</th>
                        <th>Dias en Indra</th>
                        <th>Estado</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var personal in TempObPersonal)
                    {
                        <tr>
                            <td>@personal.ID</td>
                            <td>@personal.PERSONAL</td>
                            <td>@personal.DNI</td>
                            <td>@personal.CELULAR</td>
                            <td>@personal.Equipo</td>
                            <td>@personal.CORREO</td>
                            <td>@personal.INGRESO_INDRA.Value.ToString("dd-MM-yyyy")</td>
                            <td>@personal.CUMPLEAÑOS.Value.ToString("dd-MM-yyyy")</td>
                        @{
                            // Calcular la diferencia de días
                            int diasDiferencia;
                            TimeSpan diferencia = DateTime.Now - personal.INGRESO_INDRA.Value;
                            if((int)diferencia.TotalDays > 0)
                            {
                                diasDiferencia = (int)diferencia.TotalDays;
                            }
                            else
                            {
                                diasDiferencia = 1;
                            }
                        }
                            <td>@diasDiferencia</td>
                            <td>@personal.ESTADO</td>
                            <td><a class="btn btn-success" href="personal/update/@personal.ID.ToString()">Actualizar</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
@code {
    List<PersonalEntity> ObPersonal = new List<PersonalEntity>();
    List<PersonalEntity> TempObPersonal = new List<PersonalEntity>();
    string Dni;
    string Nombre;
    DateTime? FechaIngreso;
    DateTime? FechaNacimiento;

    protected override async Task OnInitializedAsync()
    {
        ObPersonal = TB_Personal.PersonalList();
        TempObPersonal = ObPersonal;
    }

    private void ChangedFilters()
    {;
        TempObPersonal = TB_Personal.FilterPersonal(Dni,Nombre,FechaIngreso,FechaNacimiento);
    } 
}
